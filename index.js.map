{"version":3,"file":"index.js","sources":["src/index.js"],"sourcesContent":["import postcss from \"postcss\";\nvar valueParser = require('postcss-value-parser');\n\nconst pf = \"--FI_\";\nconst CS = \" > *\";\nconst SS = \" > ::slotted(*)\";\n\n// function supportNativeSolution(decl) {\n// \tconst container = decl.parent;\n\n// \tconst item = postcss.rule({ selector: container.selector + CS });\n\n// \tvar mediaRule = postcss.rule({ selector: '@media (pointer: coarse), (pointer: fine)' })\n// \tvar supportsRule = postcss.rule({ selector: '@supports (-moz-user-select: none) or ((display: flow-root) and(- webkit - initial - letter: 1)) or (width: max(1px, 2px))' })\n// \tvar cssRule = postcss.rule({ selector: container.selector })\n\n// \tvar cssRule2 = postcss.rule({ selector: item.selector })\n\n// \tsupportsRule.append(cssRule2)\n\n// \tsupportsRule.append(cssRule)\n\n// \tcssRule2.append(\n// \t\t`margin: initial;`\n// \t);\n\n// \tcssRule.append(\n// \t\t`margin-top: initial;\n// \t\t padding: initial;`\n// \t);\n\n// \tmediaRule.append(supportsRule)\n\n// \tcontainer.after(mediaRule)\n// }\n\nfunction hasFlex(decl) {\n\tconst container = decl.parent;\n\n\tconst item = postcss.rule({ selector: container.selector + CS });\n\n\tif (decl.value === \"flex\" || decl.value === \"inline-flex\") {\n\t\tcontainer.before(item);\n\n\t\tcontainer.append(\n\t\t\t`${pf}has-polyfil_gap-container: initial;`\n\t\t);\n\t\titem.append(\n\t\t\t`${pf}has-polyfil_gap-item: initial;`\n\t\t);\n\t}\n\n\titem.walk(i => { i.raws.before = \"\\n\\t\" });\n}\n\n\nfunction addgap(decl, opts) {\n\n\tconst container = decl.parent;\n\n\tconst item = postcss.rule({ selector: container.selector + CS });\n\tconst reset = postcss.rule({ selector: container.selector + CS + CS });\n\tconst slotted = postcss.rule({ selector: container.selector + SS });\n\tcontainer.before(item);\n\titem.before(reset);\n\n\n\tvar values = postcss.list.space(decl.value);\n\n\tconst properties = [\"_row\", \"_column\"];\n\n\tif (values.length === 1) {\n\t\tvalues.push(values[0]);\n\t}\n\n\tproperties.forEach((axis, index) => {\n\t\tvar value = values[index];\n\n\t\tif (value === \"0\") {\n\t\t\tvalue = \"0px\";\n\t\t}\n\t\tvar number = valueParser.unit(value).number;\n\t\tvar unit = valueParser.unit(value).unit;\n\n\t\t// Percentages\n\t\tif (unit === \"%\") {\n\t\t\t// formula: (parent - self) / (100 - self) * 100\n\t\t\tcontainer.append(\n\t\t\t\t`${pf}gap_percentage-decimal${axis}: ${number / 100};\n\t\t\t\t${pf}gap_container${axis}: var(${pf}has-polyfil_gap-container, var(${pf}gap_percentage-to-pixels${axis}, calc( ((var(${pf}gap_parent${axis}, 0%) - ${value}) * var(${pf}width_percentages-decimal, 1)) / (100 - ${number}) * 100))) !important;`\n\t\t\t);\n\n\t\t}\n\n\t\t// Pixels, Ems\n\t\telse {\n\t\t\t// formula: (parent - self)\n\t\t\tcontainer.append(\n\t\t\t\t`${pf}gap_container${axis}: var(${pf}has-polyfil_gap-container, calc(var(${pf}gap_parent${axis}, 0px) - ${value})) !important;`\n\t\t\t);\n\n\t\t}\n\n\t\treset.append(\n\t\t\t`${pf}gap_item${axis}: initial;`\n\t\t);\n\n\t\titem.append(\n\t\t\t`${pf}gap_container${axis}: initial;\n\t\t\t${pf}gap_parent${axis}: var(${pf}has-polyfil_gap-item, ${value}) !important;\n\t\t\t${pf}gap_item${axis}: var(${pf}has-polyfil_gap-item, ${value}) !important;\n\t\t\t${pf}gap${axis}: var(${pf}gap_item${axis});`\n\t\t);\n\n\t\tif (axis === \"_row\") {\n\t\t\titem.append(\n\t\t\t\t`margin-top: var(${pf}gap${axis});`\n\t\t\t);\n\t\t}\n\t\tif (axis === \"_column\") {\n\t\t\titem.append(\n\t\t\t\t`margin-right: var(${pf}gap${axis});`\n\t\t\t);\n\t\t}\n\n\t\tcontainer.append(\n\t\t\t`${pf}gap_parent${axis}: initial;\n\t\t\t${pf}gap_item${axis}: initial;\n\t\t\t${pf}gap${axis}: var(${pf}gap_container${axis}) !important;\n\t\t\tpadding-top: 0.02px;`\n\t\t);\n\n\t\tif (axis === \"_row\") {\n\t\t\tcontainer.append(\n\t\t\t\t`margin-top: var(${pf}gap${axis});`\n\t\t\t);\n\t\t}\n\t\tif (axis === \"_column\") {\n\t\t\tcontainer.append(\n\t\t\t\t`margin-right: var(${pf}gap${axis});`\n\t\t\t);\n\t\t}\n\n\t\t// If web components\n\t\tif (opts === true) {\n\t\t\tcontainer.before(slotted);\n\n\t\t\tslotted.append(\n\t\t\t\t`${pf}gap_parent${axis}: ${value};\n\t\t\t\t${pf}gap_item${axis}: ${value};\n\t\t\t\t${pf}gap${axis}: var(${pf}gap_item${axis});`\n\t\t\t);\n\n\t\t\tif (axis === \"_row\") {\n\t\t\t\tslotted.append(\n\t\t\t\t\t`margin-top: var(${pf}gap${axis}) !important;`\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (axis === \"_column\") {\n\t\t\t\tslotted.append(\n\t\t\t\t\t`margin-right: var(${pf}gap${axis}) !important;`\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// container.append(\n\t\t// \t`width: 100%;\n\t\t// \tflex-grow: 0;`);\n\t});\n\n\n\n\tcontainer.walk(i => { i.raws.before = \"\\n\\t\" });\n\titem.walk(i => { i.raws.before = \"\\n\\t\" });\n\treset.walk(i => { i.raws.before = \"\\n\\t\" });\n\tslotted.walk(i => { i.raws.before = \"\\n\\t\" });\n\n\tdecl.remove();\n}\n\nfunction addWidth(decl) {\n\n\tvar value = valueParser.unit(decl.value);\n\tlet prop = decl.prop;\n\n\tif (decl.value === 0) {\n\t\tdecl.value = \"0px\";\n\t}\n\n\tconst container = decl.parent;\n\tconst reset = postcss.rule({ selector: container.selector + CS });\n\n\tcontainer.before(reset);\n\n\tlet axis = \"\";\n\n\tif (prop === \"width\") {\n\t\taxis = \"_column\";\n\t}\n\telse {\n\t\taxis = \"_row\"\n\t}\n\n\t// Percentages\n\tif (value.unit === \"%\") {\n\t\tcontainer.append(\n\t\t\t`${pf}${prop}_percentages-decimal: ${value.number / 100} !important;`\n\t\t);\n\t\t// container.append(\n\t\t// \t`${pf}${prop}: calc(${decl.value} - var(${pf}gap_container${axis}, 0%)) !important;`\n\t\t// );\n\n\t\treset.append(\n\t\t\t`${pf}${prop}_percentages-decimal: initial;`\n\t\t);\n\t}\n\n\t// Pixels, Ems\n\telse {\n\t\tcontainer.append(\n\t\t\t`${pf}gap_percentage-to-pixels_column: calc(${\"-\" + decl.value} * var(${pf}gap_percentage-decimal${axis})) !important;\n\t\t\t${pf}gap_percentage-to-pixels_row: calc(${\"-\" + decl.value} * var(${pf}gap_percentage-decimal${axis})) !important;`\n\t\t);\n\t\tcontainer.append(\n\t\t\t`${pf}${prop}: calc(${decl.value} - var(${pf}gap_container${axis}, 0%)) !important;`\n\t\t);\n\n\t\treset.append(\n\t\t\t`${pf}gap_percentage-to-pixels_column: initial;\n\t\t\t${pf}gap_percentage-to-pixels_row: initial;`\n\t\t);\n\t}\n\n\t// decl.before(\n\t// \t`${prop}: var(${pf}${prop});`\n\t// );\n\n\t// decl.remove();\n\n\tcontainer.walk(i => { i.raws.before = \"\\n\\t\"; });\n\treset.walk(i => { i.raws.before = \"\\n\\t\"; });\n\n\n}\n\nexport default postcss.plugin(\"postcss-gap\", (opts) => {\n\tvar webComponents = false;\n\tif (opts && opts.webComponents) {\n\t\twebComponents = true;\n\t}\n\n\treturn function (css) {\n\t\tconst root = postcss.rule({ selector: \":root\" });\n\n\t\tcss.prepend(root);\n\n\t\troot.append(\n\t\t\t`${pf}has-polyfil_gap-container: 0px;\n\t\t\t${pf}has-polyfil_gap-item: 0px;`\n\t\t);\n\n\t\troot.walk(i => { i.raws.before = \"\\n\\t\"; });\n\n\t\tcss.walkDecls(function (decl) {\n\t\t\tif (decl.prop === \"width\" || decl.prop === \"height\") {\n\t\t\t\taddWidth(decl);\n\t\t\t}\n\t\t\tif (decl.prop === \"display\") {\n\t\t\t\thasFlex(decl);\n\t\t\t}\n\t\t\tif (decl.prop === \"gap\") {\n\n\t\t\t\tdecl.parent.walkDecls(function (declTwo) {\n\t\t\t\t\tif (declTwo.prop === \"display\") {\n\t\t\t\t\t\tif (declTwo.value !== \"grid\") {\n\t\t\t\t\t\t\taddgap(decl, webComponents);\n\t\t\t\t\t\t\t// supportNativeSolution(decl);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\t};\n});\n"],"names":["valueParser","require","pf","CS","SS","hasFlex","decl","container","parent","item","postcss","rule","selector","value","before","append","walk","i","raws","addgap","opts","reset","slotted","values","list","space","properties","length","push","forEach","axis","index","number","unit","remove","addWidth","prop","plugin","webComponents","css","root","prepend","walkDecls","declTwo"],"mappings":"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"}