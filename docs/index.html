<style>:root {
	--has-display-flex: initial;
	--parent-has-display-flex: initial;
}

body {
	padding: 3em;
	font-family: sans-serif;
}

.page {
	max-width: 50em;
	margin-left: auto;
	margin-right: auto;
}

.outline {
	display: flow-root;
	position: relative;
	margin-bottom: 4em
}

.outline::after {
		content: '';
		display: block;
		position: absolute;
		top: -1px;
		bottom: -1px;
		left: -1px;
		right: -1px;
		border: 1px dotted black;
		pointer-events: none;
	}

.container {
	padding: 0 !important;
	background: transparent !important;
	font-size: 13px
}

.container > * {
			box-sizing: border-box;
			background: pink;
			border-radius: 5px;
			padding: 1em;
			font-weight: bold;
		}

.container > .container > * {
			background: aqua;
		}

.container > .container > .container > * {
			background: lightgrey;
		}

.container > .container > .container > .container > * {
			background: yellow;
		}

.flexGapNotSupported .flex-wrap > * {
	/* -fgp */
	--parent-has-display-flex: !important;
}

.flexGapNotSupported .flex-wrap {
	/* -fgp */
}

.flex-wrap {
	display: flex;
	--has-display-flex: ;
	flex-wrap: wrap;
}

.flexGapNotSupported .gap-20px > * > * {
	/* -fgp */
	--parent-has-display-flex: initial;
}

.flexGapNotSupported .gap-20px > * {
	/* -fgp */
	--parent-has-display-flex: !important;
	--fgp-parent-gap-row: var(--gap);
	--fgp-margin-top: var(--parent-has-display-flex) var(--fgp-gap-row);
	margin-top: var(--fgp-margin-top);
	--fgp-parent-gap-column: var(--gap);
	--fgp-margin-left: var(--parent-has-display-flex) var(--fgp-gap-column);
	margin-left: var(--fgp-margin-left);
}

.flexGapNotSupported .gap-20px {
	/* -fgp */
	--fgp-gap-row: var(--gap);
	--fgp-margin-top: var(--has-display-flex) calc(var(--fgp-parent-gap-row, 0px) - var(--fgp-gap-row) + var(--orig-margin-top, 0px)) !important;
	--fgp-gap-column: var(--gap);
	--fgp-margin-left: var(--has-display-flex) calc(var(--fgp-parent-gap-column, 0px) - var(--fgp-gap-column) + var(--orig-margin-left, 0px)) !important;
}

.gap-20px {
	display: flex;
	--has-display-flex: ;
	--gap: 20px;
	--fgp-gap: var(--has-display-flex, var(--gap));
	gap: var(--fgp-gap, 0px);
	margin-top: var(--fgp-margin-top, var(--orig-margin-top));
	margin-left: var(--fgp-margin-left, var(--orig-margin-left));

}

.flexGapNotSupported .gap-40px > * > * {
	/* -fgp */
	--parent-has-display-flex: initial;
}

.flexGapNotSupported .gap-40px > * {
	/* -fgp */
	--parent-has-display-flex: !important;
	--fgp-parent-gap-row: 40px;
	--fgp-margin-top: var(--parent-has-display-flex) var(--fgp-gap-row);
	margin-top: var(--fgp-margin-top);
	--fgp-parent-gap-column: 40px;
	--fgp-margin-left: var(--parent-has-display-flex) var(--fgp-gap-column);
	margin-left: var(--fgp-margin-left);
}

.flexGapNotSupported .gap-40px {
	/* -fgp */
	--fgp-gap-row: 40px;
	--fgp-margin-top: var(--has-display-flex) calc(var(--fgp-parent-gap-row, 0px) - var(--fgp-gap-row) + var(--orig-margin-top, 0px)) !important;
	--fgp-gap-column: 40px;
	--fgp-margin-left: var(--has-display-flex) calc(var(--fgp-parent-gap-column, 0px) - var(--fgp-gap-column) + var(--orig-margin-left, 0px)) !important;
}

.gap-40px {
	display: flex;
	--has-display-flex: ;
	--fgp-gap: var(--has-display-flex, 40px);
	gap: var(--fgp-gap, 0px);
	margin-top: var(--fgp-margin-top, var(--orig-margin-top));
	margin-left: var(--fgp-margin-left, var(--orig-margin-left));
}

.flexGapNotSupported .flex.gap-40px-no-flex > * > *, .flexGapNotSupported .inline-flex.gap-40px-no-flex > * > * {
	/* -fgp */
}

.flexGapNotSupported .flex.gap-40px-no-flex > *, .flexGapNotSupported .inline-flex.gap-40px-no-flex > * {
	/* -fgp */
	--fgp-parent-gap-row: 40px;
	--fgp-margin-top: var(--parent-has-display-flex) var(--fgp-gap-row);
	margin-top: var(--fgp-margin-top);
	--fgp-parent-gap-column: 40px;
	--fgp-margin-left: var(--parent-has-display-flex) var(--fgp-gap-column);
	margin-left: var(--fgp-margin-left);
}

.flexGapNotSupported .flex.gap-40px-no-flex, .flexGapNotSupported .inline-flex.gap-40px-no-flex {
	/* -fgp */
	--fgp-gap-row: 40px;
	--fgp-margin-top: var(--has-display-flex) calc(var(--fgp-parent-gap-row, 0px) - var(--fgp-gap-row) + var(--orig-margin-top, 0px)) !important;
	--fgp-gap-column: 40px;
	--fgp-margin-left: var(--has-display-flex) calc(var(--fgp-parent-gap-column, 0px) - var(--fgp-gap-column) + var(--orig-margin-left, 0px)) !important;
}

.gap-40px-no-flex {
	--fgp-gap: var(--has-display-flex, 40px);
	gap: var(--fgp-gap, 0px);
	margin-top: var(--fgp-margin-top, var(--orig-margin-top));
	margin-left: var(--fgp-margin-left, var(--orig-margin-left));
}

.flexGapNotSupported .row-gap-40px > * > * {
	/* -fgp */
	--parent-has-display-flex: initial;
}

.flexGapNotSupported .row-gap-40px > * {
	/* -fgp */
	--parent-has-display-flex: !important;
	--fgp-parent-gap-row: 40px;
	--fgp-margin-top: var(--parent-has-display-flex) var(--fgp-gap-row);
	margin-top: var(--fgp-margin-top);
}

.flexGapNotSupported .row-gap-40px {
	/* -fgp */
	--fgp-gap-row: 40px;
	--fgp-margin-top: var(--has-display-flex) calc(var(--fgp-parent-gap-row, 0px) - var(--fgp-gap-row) + var(--orig-margin-top, 0px)) !important;
}

.row-gap-40px {
	display: flex;
	--has-display-flex: ;
	--fgp-row-gap: var(--has-display-flex, 40px);
	row-gap: var(--fgp-row-gap, 0px);
	margin-top: var(--fgp-margin-top, var(--orig-margin-top));
}

.flexGapNotSupported .column-gap-20px > * > * {
	/* -fgp */
	--parent-has-display-flex: initial;
}

.flexGapNotSupported .column-gap-20px > * {
	/* -fgp */
	--parent-has-display-flex: !important;
	--fgp-parent-gap-column: 20px;
	--fgp-margin-left: var(--parent-has-display-flex) var(--fgp-gap-column);
	margin-left: var(--fgp-margin-left);
}

.flexGapNotSupported .column-gap-20px {
	/* -fgp */
	--fgp-gap-column: 20px;
	--fgp-margin-left: var(--has-display-flex) calc(var(--fgp-parent-gap-column, 0px) - var(--fgp-gap-column) + var(--orig-margin-left, 0px)) !important;
}

.column-gap-20px {
	display: flex;
	--has-display-flex: ;
	-moz-column-gap: 20px;
	--fgp-column-gap: var(--has-display-flex, 20px);
	column-gap: var(--fgp-column-gap, 0px);
	margin-left: var(--fgp-margin-left, var(--orig-margin-left));
}

.flexGapNotSupported .gap-3\% > * > * {
	/* -fgp */
	--parent-has-display-flex: initial;
}

.flexGapNotSupported .gap-3\% > * {
	/* -fgp */
	--parent-has-display-flex: !important;
	--fgp-parent-gap-row: 10%;
	--fgp-margin-top: var(--parent-has-display-flex) var(--fgp-gap-row);
	margin-top: var(--fgp-margin-top);
	--fgp-parent-gap-column: 10%;
	--fgp-margin-left: var(--parent-has-display-flex) var(--fgp-gap-column);
	margin-left: var(--fgp-margin-left);
}

.flexGapNotSupported .gap-3\% {
	/* -fgp */
	--fgp-gap-row: 10%;
	--fgp-margin-top: calc(
						(var(--fgp-parent-gap-row, 0px) - var(--fgp-gap-row) / (100 - 10) * 100)
						+ var(--fgp-orig-margin-top, 0px)
						) !important;
	--fgp-gap-column: 10%;
	--fgp-margin-left: calc(
						(var(--fgp-parent-gap-column, 0px) - var(--fgp-gap-column) / (100 - 10) * 100)
						+ var(--fgp-orig-margin-left, 0px)
						) !important;
}

.gap-3\% {
	display: flex;
	--has-display-flex: ;
	--fgp-gap: var(--has-display-flex, 10%);
	gap: var(--fgp-gap, 0px);
	margin-top: var(--fgp-margin-top, var(--orig-margin-top));
	margin-left: var(--fgp-margin-left, var(--orig-margin-left));
}

.flexGapNotSupported .gap-6\% > * > * {
	/* -fgp */
	--parent-has-display-flex: initial;
}

.flexGapNotSupported .gap-6\% > * {
	/* -fgp */
	--parent-has-display-flex: !important;
	--fgp-parent-gap-row: 16%;
	--fgp-margin-top: var(--parent-has-display-flex) var(--fgp-gap-row);
	margin-top: var(--fgp-margin-top);
	--fgp-parent-gap-column: 16%;
	--fgp-margin-left: var(--parent-has-display-flex) var(--fgp-gap-column);
	margin-left: var(--fgp-margin-left);
}

.flexGapNotSupported .gap-6\% {
	/* -fgp */
	--fgp-gap-row: 16%;
	--fgp-margin-top: calc(
						(var(--fgp-parent-gap-row, 0px) - var(--fgp-gap-row) / (100 - 16) * 100)
						+ var(--fgp-orig-margin-top, 0px)
						) !important;
	--fgp-gap-column: 16%;
	--fgp-margin-left: calc(
						(var(--fgp-parent-gap-column, 0px) - var(--fgp-gap-column) / (100 - 16) * 100)
						+ var(--fgp-orig-margin-left, 0px)
						) !important;
}

.gap-6\% {
	display: flex;
	--has-display-flex: ;
	--fgp-gap: var(--has-display-flex, 16%);
	gap: var(--fgp-gap, 0px);
	margin-top: var(--fgp-margin-top, var(--orig-margin-top));
	margin-left: var(--fgp-margin-left, var(--orig-margin-left));
}

.flexGapNotSupported .gap-2em > * > * {
	/* -fgp */
	--parent-has-display-flex: initial;
}

.flexGapNotSupported .gap-2em > * {
	/* -fgp */
	--parent-has-display-flex: !important;
	--fgp-parent-gap-row: 2em;
	--fgp-margin-top: var(--parent-has-display-flex) var(--fgp-gap-row);
	margin-top: var(--fgp-margin-top);
	--fgp-parent-gap-column: 2em;
	--fgp-margin-left: var(--parent-has-display-flex) var(--fgp-gap-column);
	margin-left: var(--fgp-margin-left);
}

.flexGapNotSupported .gap-2em {
	/* -fgp */
	--fgp-gap-row: 2em;
	--fgp-margin-top: var(--has-display-flex) calc(var(--fgp-parent-gap-row, 0px) - var(--fgp-gap-row) + var(--orig-margin-top, 0px)) !important;
	--fgp-gap-column: 2em;
	--fgp-margin-left: var(--has-display-flex) calc(var(--fgp-parent-gap-column, 0px) - var(--fgp-gap-column) + var(--orig-margin-left, 0px)) !important;
}

.gap-2em {
	display: flex;
	--has-display-flex: ;
	--fgp-gap: var(--has-display-flex, 2em);
	gap: var(--fgp-gap, 0px);
	margin-top: var(--fgp-margin-top, var(--orig-margin-top));
	margin-left: var(--fgp-margin-left, var(--orig-margin-left));
}

.flexGapNotSupported .gap-20px.margin-20px > * > * {
	/* -fgp */
	--parent-has-display-flex: initial;
}

.flexGapNotSupported .gap-20px.margin-20px > * {
	/* -fgp */
	--parent-has-display-flex: !important;
	--fgp-parent-gap-row: 20px;
	--fgp-margin-top: var(--parent-has-display-flex) var(--fgp-gap-row);
	margin-top: var(--fgp-margin-top);
	--fgp-parent-gap-column: 20px;
	--fgp-margin-left: var(--parent-has-display-flex) var(--fgp-gap-column);
	margin-left: var(--fgp-margin-left);
}

.flexGapNotSupported .gap-20px.margin-20px {
	/* -fgp */
	--fgp-gap-row: 20px;
	--fgp-margin-top: var(--has-display-flex) calc(var(--fgp-parent-gap-row, 0px) - var(--fgp-gap-row) + var(--orig-margin-top, 0px)) !important;
	--fgp-gap-column: 20px;
	--fgp-margin-left: var(--has-display-flex) calc(var(--fgp-parent-gap-column, 0px) - var(--fgp-gap-column) + var(--orig-margin-left, 0px)) !important;
}

.gap-20px.margin-20px {
	display: flex;
	--has-display-flex: ;
	--fgp-gap: var(--has-display-flex, 20px);
	gap: var(--fgp-gap, 0px);
	--orig-margin-top: 20px;
	--orig-margin-right: 20px;
	--orig-margin-bottom: 20px;
	--orig-margin-left: 20px;
	margin: var(--fgp-margin-top) var(--orig-margin-right) var(--orig-margin-bottom) var(--fgp-margin-left);
}

.space-evenly {
	justify-content: space-evenly;
}

.justify-flex-end {
	justify-content: flex-end;
}

.grow {
	flex-grow: 1;
}

.item-50\% {
	width: calc(50% - var(--gap));
}

.grid {
	display: grid;--orig-margin-left: 20px;
	margin-left: var(--fgp-margin-left, var(--orig-margin-left));
}

.flexGapNotSupported .flex > * {
	/* -fgp */
	--parent-has-display-flex: !important;
}

.flexGapNotSupported .flex {
	/* -fgp */
}

.flex {
	display: flex;
	--has-display-flex: ;
}

.no-flex {
	--has-display-flex: initial;
}
.no-flex > * {
	--parent-has-display-flex: initial !important;
}

.w {
	width: auto;
}
</style>

<div class="page flexGapNotSupported">

	<h1>Flex Gap Polyfill</h1>

	<p>Below are a list of test cases demonstrating scenarios this polyfill works with.</p>
	<p>View on <a href="https://github.com/limitlessloop/flex-gap-polyfill">github</a>.</p>

	<h4>Basic</h4>
	<pre>
.container {
	display: flex;
	flex-wrap: wrap;
	gap: 20px;
}
	</pre>

	<div class="outline">
		<div class="container gap-20px flex-wrap">
			<div>One</div>
			<div>Two</div>
			<div>Three</div>
			<div>Four</div>
			<div>Five</div>
		</div>
	</div>

	<h3>Nested</h3>

	<pre>
.container {
	display: flex;
	flex-wrap: wrap;
	gap: 20px;
}

.container .container {
	display: flex;
	flex-wrap: wrap;
	gap: 40px;
}
	</pre>

	<div class="outline">
		<div class="container gap-40px flex-wrap">
			<div>A</div>
			<div>B</div>
			<div>C</div>
			<div>D</div>
			<div class="container gap-20px flex-wrap">
				<div>A</div>
				<div>B</div>
				<div>C</div>
				<div>D</div>
			</div>
		</div>
	</div>

	<h3>Percentages</h3>

	<p>(Percentage row gaps only appear when height is specified, disabled in polyfill for now).</p>

	<pre>
.container
	display: flex;
	flex-wrap: wrap;
	gap: 6%;
}
	</pre>

	<div class="outline">
		<div class="container gap-6% flex-wrap">
			<div>A</div>
			<div>B</div>
			<div>C</div>
			<div>D</div>
		</div>
	</div>

		<h3>Ems</h3>

	<pre>
.container
	display: flex;
	flex-wrap: wrap;
	gap: 2em;
}
	</pre>

	<div class="outline">
		<div class="container gap-2em flex-wrap">
			<div>A</div>
			<div>B</div>
			<div>C</div>
			<div>D</div>
		</div>
	</div>

	<h3>Nested Combination (% > px, px > %, em > px, etc)</h3>

	<pre>
.container
	display: flex;
	flex-wrap: wrap;
	gap: 6%;
}

.container .container {
	display: flex;
	flex-wrap: wrap;
	gap: 20px;
}
	</pre>

	<div class="outline">
		<div class="container gap-6% flex-wrap">
			<div>A</div>
			<div>B</div>
			<div>C</div>
			<div>D</div>
			<div class="container gap-20px flex-wrap">
				<div>A</div>
				<div>B</div>
				<div>C</div>
				<div>D</div>
			</div>
		</div>
	</div>

	<pre>
.container
	display: flex;
	flex-wrap: wrap;
	gap: 6%;
}

.container .container {
	display: flex;
	flex-wrap: wrap;
	gap: 3%;
}
	</pre>

	<div class="outline">
		<div class="container gap-6% flex-wrap">
			<div>A</div>
			<div>B</div>
			<div>C</div>
			<div>D</div>
			<div class="container gap-3% flex-wrap">
				<div>A</div>
				<div>B</div>
				<div>C</div>
				<div>D</div>
			</div>
		</div>
	</div>

		<pre>
.container
	display: flex;
	flex-wrap: wrap;
}

.container .container {
	display: flex;
	flex-wrap: wrap;
	gap: 3%;
}
	</pre>

	<div class="outline">
		<div class="container flex-wrap">
			<div>A</div>
			<div>B</div>
			<div>C</div>
			<div>D</div>
			<div class="container gap-6% flex-wrap">
				<div>A</div>
				<div>B</div>
				<div>C</div>
				<div>D</div>
			</div>
		</div>
	</div>

	<h3>Margin + Gap</h3>

	<pre>
.container
	display: flex;
	flex-wrap: wrap;
	margin: 20px;
	gap: 3%;
}
	</pre>

	<div class="outline">
		<div class="container gap-20px margin-20px flex-wrap">
			<div>A</div>
			<div>B</div>
			<div>C</div>
			<div>D</div>
		</div>
	</div>

	<h3>Justify End</h3>

	<pre>
.container
	display: flex;
	flex-wrap: wrap;
	justify-content: flex-end;
	gap: 3%;
}
	</pre>

	<div class="outline">
		<div class="container gap-40px flex-wrap space-evenly justify-flex-end">
			<div>A</div>
			<div>B</div>
			<div>C</div>
			<div>D</div>
		</div>
	</div>

	<h3>Space Evenly</h3>

	<pre>
.container
	display: flex;
	flex-wrap: wrap;
	gap: 3%;
	justify-content: space-evenly;
}
	</pre>

	<div class="outline">
		<div class="container gap-40px flex-wrap space-evenly">
			<div>A</div>
			<div>B</div>
			<div>C</div>
			<div>D</div>
		</div>
	</div>

	<h3>Grid</h3>

	<pre>
.container {
	display: flex;
	flex-wrap: wrap;
	flex-grow: 1;
	--gap: 20px;
	gap: var(--gap);
}

.item-50% {
	width: calc(50% - var(--gap))
}
	</pre>

	<div class="outline">
		<div class="container gap-20px flex-wrap grow">
			<div class="item-50%">A</div>
			<div class="item-50%">B</div>
			<div class="item-50%">C</div>
			<div class="item-50%">D</div>
		</div>
	</div>

	<h3>Columns and Rows Independently</h3>

	<pre>
.container {
	display: flex;
	flex-wrap: wrap;
	row-gap: 40px;
}

.container .container {
	display: flex;
	flex-wrap: wrap;
	column-gap: 20px;
}
	</pre>

	<div class="outline">
		<div class="container row-gap-40px flex-wrap">
			<div>A</div>
			<div>B</div>
			<div>C</div>
			<div>D</div>
			<div class="container column-gap-20px flex-wrap">
				<div>A</div>
				<div>B</div>
				<div>C</div>
				<div>D</div>
			</div>
		</div>
	</div>

	<h3>When container doesn't have flex</h3>

	<pre>
.container {
	display: grid;
	gap: 40px;
	margin-left: 40px;
}
	</pre>

	<div class="outline">
		<div class="container grid gap-40px-no-flex">
			<div>A</div>
			<div>B</div>
			<div>C</div>
			<div>D</div>
		</div>
	</div>

</div>

