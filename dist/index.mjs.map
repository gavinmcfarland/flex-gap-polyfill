{"version":3,"file":"index.mjs","sources":["../src/index.js"],"sourcesContent":["import postcss from \"postcss\";\nconst { parse } = require('postcss-values-parser');\n\n// var twMarginRegex = /^.-?m(y-[0-9]|x-[0-9]|-px|-[0-9].?[0-9]?)/gmi\n\n// TODO: To support Tailwind need to cover all variants of class names including device eg md:. margin, width, flex, height\n\nmodule.exports = (opts = {}) => {\n\topts = opts || {}\n\n\tconst pf = \"fgp-\";\n\tconst flexGapNotSupported = opts.flexGapNotSupported ? opts.flexGapNotSupported + \" \" : \"\";\n\n\tfunction getFlex(decl, obj) {\n\t\tif (decl.prop === \"display\" && decl.value === \"flex\" || decl.prop === \"display\" && decl.value === \"inline-flex\") {\n\t\t\tobj.hasFlex = true;\n\t\t}\n\t}\n\n\tfunction getWidth(decl, obj) {\n\t\tif (decl.prop === \"width\") {\n\t\t\tobj.hasWidth = true\n\t\t}\n\t\tif (decl.prop === \"height\") {\n\t\t\tobj.hasHeight = true\n\t\t}\n\t}\n\n\tfunction getGap(decl, obj) {\n\t\tif (decl.prop === \"gap\" || decl.prop === \"column-gap\" || decl.prop === \"row-gap\") {\n\t\t\tobj.hasGap = true;\n\t\t\tif (decl.prop === \"row-gap\") {\n\t\t\t\tobj.gapValues[0] = decl.value\n\t\t\t}\n\n\t\t\tif (decl.prop === \"column-gap\") {\n\t\t\t\tobj.gapValues[1] = decl.value\n\t\t\t}\n\n\t\t\tif (decl.prop === \"gap\") {\n\t\t\t\tobj.gapValues = postcss.list.space(decl.value);\n\t\t\t\tif (obj.gapValues.length === 1) {\n\t\t\t\t\tobj.gapValues.push(obj.gapValues[0]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tfunction getMargin(decl, obj) {\n\t\tif (decl.prop === \"margin\" || decl.prop === \"margin-left\" || decl.prop === \"margin-top\") {\n\t\t\tif (decl.prop === \"margin-top\") {\n\t\t\t\tobj.marginValues[0] = decl.value\n\t\t\t}\n\n\t\t\tif (decl.prop === \"margin-left\") {\n\t\t\t\tobj.marginValues[1] = decl.value\n\t\t\t}\n\n\t\t\tif (decl.prop === \"margin\") {\n\t\t\t\tobj.marginValues = postcss.list.space(decl.value);\n\t\t\t\tif (obj.marginValues.length === 1) {\n\t\t\t\t\tobj.marginValues.push(obj.marginValues[0]);\n\t\t\t\t}\n\t\t\t\tif (obj.marginValues.length > 1) {\n\t\t\t\t\tobj.marginValues = obj.marginValues.slice(0, 2);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// TODO: Try moving this function to walking decls\n\tfunction getRules(decl, obj, root) {\n\t\tvar fileName = root.source.input.file\n\t\tobj.rules.orig = decl.parent\n\n\t\tvar selector;\n\n\n\t\t// These are needed to specifiy global scope for CSS modules\n\t\tvar cssModule = \"\";\n\t\tvar cssModuleEnd = \"\"\n\n\t\tif ((fileName && fileName.endsWith(\".module.css\")) && opts.flexGapNotSupported) {\n\t\t\tcssModule = \":global(\"\n\t\t\tcssModuleEnd = \") \"\n\t\t}\n\n\t\t// if (obj.hasGap && obj.hasFlex) {\n\t\tselector = {\n\t\t\tcontainer: `${cssModule}${flexGapNotSupported}${cssModuleEnd}${obj.rules.orig.selector}`,\n\t\t\titem: `${cssModule}${flexGapNotSupported}${cssModuleEnd}${obj.rules.orig.selector} > *`,\n\t\t\treset: `${cssModule}${flexGapNotSupported}${cssModuleEnd}${obj.rules.orig.selector} > * > *`,\n\t\t\tslotted: `${cssModule}${flexGapNotSupported}${cssModuleEnd}${obj.rules.orig.selector} > ::slotted(*)`\n\t\t};\n\t\t// }\n\n\t\tif ((opts.tailwindCSS && /^.gap(?=\\b|[0-9])/gmi.test(obj.rules.orig.selector) && !obj.hasFlex) || (obj.hasWidth || obj.hasHeight) || (opts.tailwindCSS && /^.-?m(y-[0-9]|x-[0-9]|-px|-[0-9].?[0-9]?)/gmi.test(obj.rules.orig.selector) && !obj.hasFlex)) {\n\t\t\tselector = {\n\t\t\t\tcontainer: `${cssModule}${flexGapNotSupported}${cssModuleEnd}.flex${obj.rules.orig.selector}, ${cssModule}${flexGapNotSupported}${cssModuleEnd}.inline-flex${obj.rules.orig.selector}`,\n\t\t\t\titem: `${cssModule}${flexGapNotSupported}${cssModuleEnd}.flex${obj.rules.orig.selector} > *, ${cssModule}${flexGapNotSupported}${cssModuleEnd}.inline-flex${obj.rules.orig.selector} > *`,\n\t\t\t\treset: `${cssModule}${flexGapNotSupported}${cssModuleEnd}.flex${obj.rules.orig.selector} > * > *, ${cssModule}${flexGapNotSupported}${cssModuleEnd}.inline-flex${obj.rules.orig.selector} > * > *`,\n\t\t\t\tslotted: `${cssModule}${flexGapNotSupported}${cssModuleEnd}.flex${obj.rules.orig.selector} > ::slotted(*), ${cssModule}${flexGapNotSupported}${cssModuleEnd}.inline-flex${obj.rules.orig.selector} > ::slotted(*)`\n\t\t\t};\n\t\t}\n\n\t\tobj.rules.container = postcss.rule({ selector: selector.container });\n\t\tobj.rules.item = postcss.rule({ selector: selector.item });\n\t\tobj.rules.reset = postcss.rule({ selector: selector.reset });\n\t\tobj.rules.slotted = postcss.rule({ selector: selector.slotted });\n\t}\n\n\t// function addRootSelector(root) {\n\t// \tvar fileName = root.source.input.file\n\n\t// \t// This avoids adding :root selector to module files used by Next.js\n\t// \tif (!(fileName && fileName.endsWith(\".module.css\"))) {\n\t// \t\tconst rootRule = postcss.rule({ selector: \":root\" });\n\n\t// \t\troot.prepend(rootRule);\n\n\t// \t\trootRule.append(\n\t// \t\t\t`${pf}has-polyfill-gap-container: 0px;\n\t// \t\t${pf}has-polyfill-gap-item: 0px;`\n\t// \t\t);\n\n\t// \t\trootRule.walk(i => { i.raws.before = \"\\n\\t\"; });\n\n\t// \t}\n\t// }\n\n\t// function addWidth(rule, obj) {\n\t// \tfunction ifUnit(value) {\n\t// \t\tvar regex = /^calc\\(|([0-9|.]+px|cm|mm|in|pt|pc|em|ex|ch|rem|vw|vh|vmin|vmax|%)$/\n\t// \t\treturn regex.test(value)\n\t// \t}\n\n\t// \tif (obj.hasWidth || obj.hasHeight) {\n\t// \t\trule.walkDecls((decl) => {\n\t// \t\t\tvar value = parse(decl.value).nodes[0];\n\t// \t\t\tlet prop = decl.prop;\n\n\t// \t\t\tif (decl.value === 0) {\n\t// \t\t\t\tdecl.value = \"0px\";\n\t// \t\t\t}\n\n\t// \t\t\tif (ifUnit(decl.value)) {\n\t// \t\t\t\tconst origContainer = obj.rules.orig;\n\t// \t\t\t\tconst container = obj.rules.container\n\t// \t\t\t\tconst reset = obj.rules.reset;\n\n\t// \t\t\t\torigContainer.after(container);\n\t// \t\t\t\tcontainer.before(reset);\n\n\t// \t\t\t\tlet axis = prop === \"width\" ? \"column\" : \"row\";\n\n\t// \t\t\t\t// Percentages\n\t// \t\t\t\tif (value.unit === \"%\") {\n\t// \t\t\t\t\tcontainer.append(\n\t// \t\t\t\t\t\t`${pf}${prop}-percentages-decimal: ${value.number / 100} !important;`\n\t// \t\t\t\t\t);\n\n\t// \t\t\t\t\treset.append(\n\t// \t\t\t\t\t\t`${pf}${prop}-percentages-decimal: initial;`\n\t// \t\t\t\t\t);\n\t// \t\t\t\t}\n\n\t// \t\t\t\t// Pixels, Ems\n\t// \t\t\t\telse {\n\t// \t\t\t\t\tcontainer.append(\n\t// \t\t\t\t\t\t`${pf}gap-percentage-to-pixels-column: calc(-1 * ${decl.value} * var(${pf}gap_percentage-decimal-${axis})) !important;\n\t// \t\t${pf}gap-percentage-to-pixels-row: calc(-1 * ${decl.value} * var(${pf}gap-percentage-decimal-${axis})) !important;`\n\t// \t\t\t\t\t);\n\n\t// \t\t\t\t\tcontainer.append(\n\t// \t\t\t\t\t\t`${pf}${prop}: calc(${decl.value} - var(${pf}gap-container-${axis}, 0%)) !important;`\n\t// \t\t\t\t\t);\n\n\t// \t\t\t\t\treset.append(\n\t// \t\t\t\t\t\t`${pf}gap-percentage-to-pixels-column: initial;\n\t// \t\t${pf}gap-percentage-to-pixels-row: initial;`\n\t// \t\t\t\t\t);\n\t// \t\t\t\t}\n\n\t// \t\t\t\tcontainer.walk(i => { i.raws.before = \"\\n\\t\"; });\n\t// \t\t\t\treset.walk(i => { i.raws.before = \"\\n\\t\"; });\n\t// \t\t\t}\n\t// \t\t})\n\t// \t}\n\t// }\n\n\t// function addFlex(rule, obj) {\n\t// \t// if (obj.hasFlex) {\n\t// \tconst origContainer = obj.rules.orig;\n\t// \tconst container = obj.rules.container;\n\t// \tconst item = obj.rules.item\n\n\t// \torigContainer.after(container);\n\n\t// \tcontainer.before(item);\n\n\t// \tcontainer.append(\n\t// \t\t`${pf}has-polyfill-gap-container: initial;`\n\t// \t);\n\t// \titem.append(\n\t// \t\t`${pf}has-polyfill-gap-item: initial;`\n\t// \t);\n\n\t// \titem.walk(i => { i.raws.before = \"\\n\\t\" });\n\t// \t// }\n\n\t// }\n\n\tfunction addGap(rule, obj, opts) {\n\n\t\tconst origContainer = obj.rules.orig;\n\t\tconst container = obj.rules.container\n\t\tconst item = obj.rules.item\n\t\tconst reset = obj.rules.reset\n\t\tconst slotted = obj.rules.slotted\n\n\t\tconst properties = [\n\t\t\t[\"row\", \"top\"],\n\t\t\t[\"column\", \"left\"]\n\t\t];\n\n\t\torigContainer.after(container);\n\t\tcontainer.before(item);\n\t\titem.before(reset);\n\n\t\t// Just a precaution incase flex gap detection has false positive\n\t\tif (opts.flexGapNotSupported) {\n\t\t\tcontainer.append(\n\t\t\t\t`gap: 0;`\n\t\t\t)\n\t\t}\n\n\t\tproperties.forEach((property, index) => {\n\n\t\t\tvar axis = property[0];\n\t\t\tvar side = property[1];\n\n\t\t\tvar value = obj.gapValues[index];\n\n\t\t\tif (value === \"0\") {\n\t\t\t\tvalue = \"0px\";\n\t\t\t}\n\t\t\tvar number = parse(value).nodes[0].value\n\t\t\tvar unit = parse(value).nodes[0].unit;\n\n\t\t\tvar percentageRowGaps = opts.percentageRowGaps || unit != \"%\" && axis === \"row\";\n\t\t\tvar axisNumber = axis === \"row\" ? 0 : 1\n\n\t\t\t// Percentages\n\t\t\tif (unit === \"%\") {\n\t\t\t\t// // formula: (parent - self) / (100 - self) * 100\n\n\n\t\t\t\tcontainer.append(\n\t\t\t\t\t`--${pf}orig-margin-${side}: ${obj.marginValues[axisNumber]};\n\t\t\t\t\t--${pf}gap-${axis}: ${value};\n\t\t\t\t\t--${pf}margin-${side}: calc(\n\t\t\t\t\t\t(var(--${pf}parent-gap-${axis}, 0px) - var(--${pf}gap-${axis}) / (100 - ${number}) * 100)\n\t\t\t\t\t\t+ var(--${pf}orig-margin-${side})\n\t\t\t\t\t\t) !important;\n\t\t\t\t\tmargin-${side}: var(--${pf}margin-${side});`\n\t\t\t\t);\n\n\t\t\t\t// if ((percentageRowGaps && axis === \"row\") || axis === \"column\") {\n\t\t\t\t// \tcontainer.append(\n\t\t\t\t// \t\t`${pf}gap-percentage-decimal-${axis}: ${number / 100};\n\t\t\t\t// ${pf}gap-container-${axis}: var(${pf}has-polyfill-gap-container, var(${pf}gap-percentage-to-pixels-${axis}, calc( ((var(${pf}gap-parent-${axis}, 0%) - ${value}) * var(${pf}width-percentages-decimal, 1)) / (100 - ${number}) * 100))) !important;`\n\t\t\t\t// \t);\n\t\t\t\t// }\n\t\t\t\t// else {\n\t\t\t\t// \tcontainer.append(\n\t\t\t\t// \t\t`${pf}gap-container-${axis}: var(--fgp-gap-item-row) !important;`\n\t\t\t\t// \t);\n\t\t\t\t// }\n\t\t\t}\n\n\t\t\t// Pixels, Ems\n\t\t\telse {\n\t\t\t\t// formula: (parent - self)\n\t\t\t\tcontainer.append(\n\t\t\t\t\t`--${pf}orig-margin-${side}: ${obj.marginValues[axisNumber]};\n\t\t\t\t\t--${pf}gap-${axis}: ${value};\n\t\t\t\t\t--${pf}margin-${side}: calc(var(--${pf}parent-gap-${axis}, 0px) - var(--${pf}gap-${axis}) + var(--${pf}orig-margin-${side})) !important;\n\t\t\t\t\tmargin-${side}: var(--${pf}margin-${side});`\n\t\t\t\t);\n\n\t\t\t\t// ${pf}gap-container-${axis}: var(${pf}has-polyfill-gap-container, calc(var(${pf}gap-parent-${axis}, 0px) - ${value})) !important;\n\n\t\t\t}\n\n\t\t\t// reset.append(\n\t\t\t// \t`${pf}gap-item-${axis}: initial;`\n\t\t\t// );\n\n\t\t\titem.append(\n\t\t\t\t`--${pf}parent-gap-${axis}: ${value};\n\t\t\t\t--${pf}margin-${side}: var(--${pf}gap-${axis});\n\t\t\t\tmargin-${side}: var(--${pf}margin-${side});`\n\t\t\t);\n\n\t\t\t// ${pf}gap-container-${axis}: initial;\n\t\t\t// ${pf}gap-item-${axis}: var(${pf}has-polyfill-gap-item, ${value}) !important;\n\t\t\t// ${pf}gap-${axis}: var(${pf}gap-item-${axis});\n\n\n\t\t\tif ((percentageRowGaps && axis === \"row\") || axis === \"column\") {\n\t\t\t\t// item.append(\n\t\t\t\t// \t`${pf}gap-parent-${axis}: var(${pf}has-polyfill-gap-item, ${value}) !important;\n\t\t\t\t// \tmargin-${side}: var(${pf}gap-${axis});`\n\t\t\t\t// );\n\t\t\t}\n\n\t\t\t// container.append(\n\t\t\t// \t`${pf}gap-parent-${axis}: initial;\n\t\t\t// ${pf}gap-item-${axis}: initial;\n\t\t\t// ${pf}gap-${axis}: var(${pf}gap-container-${axis}) !important;`\n\t\t\t// );\n\n\t\t\t// if ((percentageRowGaps && axis === \"row\") || axis === \"column\") {\n\t\t\t// \t// Needed to switch margin values depending on row/top or column/left marginValues => [top, left] // may need changing to [top, right, bottom, left]?\n\t\t\t// \tvar axisNumber = axis === \"row\" ? 0 : 1\n\t\t\t// \t// Moved !important to from margin property to custom property. Not sure if this breaks anything\n\t\t\t// \tcontainer.append(\n\t\t\t// \t\t`${pf}margin-${side}: calc(var(${pf}gap-${axis}) + ${obj.marginValues[axisNumber]}) !important;\n\t\t\t// \t\tmargin-${side}: var(${pf}margin-${side});`\n\t\t\t// \t);\n\t\t\t// }\n\n\t\t\t// If web components\n\t\t\tif (opts.webComponents === true) {\n\t\t\t\t// container.before(slotted);\n\n\t\t\t\t// slotted.append(\n\t\t\t\t// \t`${pf}gap-parent-${axis}: ${value};\n\t\t\t\t// ${pf}gap-item-${axis}: ${value};\n\t\t\t\t// ${pf}gap-${axis}: var(${pf}gap-item-${axis});`\n\t\t\t\t// );\n\n\t\t\t\t// if ((percentageRowGaps && axis === \"row\") || axis === \"column\") {\n\t\t\t\t// \tslotted.append(\n\t\t\t\t// \t\t`margin-${side}: var(${pf}gap-${axis}) !important;`\n\t\t\t\t// \t);\n\t\t\t\t// }\n\t\t\t}\n\n\t\t});\n\n\t\titem.append(`pointer-events: all;`)\n\t\tcontainer.append(\n\t\t\t`pointer-events: none;\n\t\tpadding-top: 0.02px;`)\n\n\t\tcontainer.walk(i => { i.raws.before = \"\\n\\t\" });\n\t\titem.walk(i => { i.raws.before = \"\\n\\t\" });\n\t\treset.walk(i => { i.raws.before = \"\\n\\t\" });\n\t\tslotted.walk(i => { i.raws.before = \"\\n\\t\" });\n\n\t}\n\n\tfunction addMargin(rule, obj) {\n\t\t// Rewrites margin properties for:\n\t\t// margin: 1em; => margin: calc() 1em calc();\n\t\t// margin-top: 1em; => margin-top: calc();\n\t\t// margin-left: 1em; => margin-left: calc();\n\n\t\tfunction ifUnit(value) {\n\t\t\tvar regex = /^calc\\(|([0-9|.]+px|cm|mm|in|pt|pc|em|ex|ch|rem|vw|vh|vmin|vmax|%)$/\n\t\t\treturn regex.test(value)\n\t\t}\n\n\t\tconst origContainer = obj.rules.orig;\n\t\tconst container = obj.rules.container\n\n\t\tif ((opts.tailwindCSS && /^.-?m(y-[0-9]|x-[0-9]|-px|-[0-9].?[0-9]?)/gmi.test(obj.rules.orig?.selector))) {\n\n\t\t\trule.walkDecls((decl) => {\n\n\t\t\t\tif (ifUnit(decl.value)) {\n\n\n\t\t\t\t\torigContainer.after(container);\n\n\t\t\t\t\tif (decl.prop === \"margin\") {\n\t\t\t\t\t\tcontainer.append(\n\t\t\t\t\t\t\t`margin: calc(var(${pf}gap-row) + ${obj.marginValues[0]}) ${obj.marginValues[1]} calc(var(${pf}gap-column) + ${obj.marginValues[0]})`\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\n\t\t\t\t\tif (decl.prop === \"margin-top\") {\n\t\t\t\t\t\tcontainer.append(\n\t\t\t\t\t\t\t`margin-top: calc(var(${pf}gap-row) + ${obj.marginValues[0]})`\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\n\t\t\t\t\tif (decl.prop === \"margin-left\") {\n\t\t\t\t\t\tcontainer.append(\n\t\t\t\t\t\t\t`margin-left: calc(var(${pf}gap-column) + ${obj.marginValues[1]})`\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\n\t\t\t\t\t// let axis = prop === \"width\" ? \"column\" : \"row\";\n\n\t\t\t\t\tcontainer.walk(i => { i.raws.before = \"\\n\\t\"; });\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tfunction removeGap(rule) {\n\t\trule.walkDecls((decl) => {\n\t\t\tif (decl.prop === \"gap\" || decl.prop === \"column-gap\" || decl.prop === \"row-gap\") {\n\t\t\t\t// FIXME: Prevent gap from being deletec in certain scenarios // Thing this is working?\n\t\t\t\tif (!(opts.flexGapNotSupported || (opts.tailwindCSS && /^.gap(?=\\b|[0-9])/gmi.test(rule.selector)))) {\n\t\t\t\t\tdecl.remove()\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\treturn {\n\t\tpostcssPlugin: 'postcss-gap',\n\t\tOnce(root) {\n\n\t\t\t// addRootSelector(root)\n\n\t\t\troot.walkRules(rule => {\n\t\t\t\tvar obj = {\n\t\t\t\t\trules: {},\n\t\t\t\t\tgapValues: ['0px', '0px'],\n\t\t\t\t\tmarginValues: ['0px', '0px'],\n\t\t\t\t\thasGap: false,\n\t\t\t\t\thasFlex: false\n\t\t\t\t}\n\n\t\t\t\trule.walkDecls((decl) => {\n\t\t\t\t\tgetFlex(decl, obj);\n\t\t\t\t\tgetGap(decl, obj)\n\t\t\t\t\tgetMargin(decl, obj)\n\t\t\t\t\tgetWidth(decl, obj)\n\t\t\t\t\tgetRules(decl, obj, root)\n\t\t\t\t});\n\n\t\t\t\t// addWidth(rule, obj);\n\t\t\t\taddMargin(rule, obj)\n\n\t\t\t\tif ((obj.hasGap && obj.hasFlex) || (opts.tailwindCSS && /^.gap(?=\\b|[0-9])/gmi.test(rule.selector) && !obj.hasFlex)) {\n\t\t\t\t\t// addFlex(rule, obj);\n\t\t\t\t\taddGap(rule, obj, opts);\n\t\t\t\t\tremoveGap(rule);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n}\n\nmodule.exports.postcss = true\n"],"names":["parse","require","module","exports","opts","pf","flexGapNotSupported","getFlex","decl","obj","prop","value","hasFlex","getWidth","hasWidth","hasHeight","getGap","hasGap","gapValues","postcss","list","space","length","push","getMargin","marginValues","slice","getRules","root","fileName","source","input","file","rules","orig","parent","selector","cssModule","cssModuleEnd","endsWith","container","item","reset","slotted","tailwindCSS","test","rule","addGap","origContainer","properties","after","before","append","forEach","property","index","axis","side","number","nodes","unit","percentageRowGaps","axisNumber","webComponents","walk","i","raws","addMargin","ifUnit","regex","walkDecls","removeGap","remove","postcssPlugin","Once","walkRules"],"mappings":"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"}